#!/bin/bash

if [ ! "$1" ]; then
    echo "$0: <target>" >&2
    exit 1
fi

BRIEGEL_TARGET="$1"

[ "$BRIEGEL_PREFIX" ]           || BRIEGEL_PREFIX="@BRIEGEL_DEFAULT_ROOT@"
[ "$BRIEGEL_LIBDIR" ]           || BRIEGEL_LIBDIR="$BRIEGEL_PREFIX/lib"
[ "$BRIEGEL_CONFDIR" ]          || BRIEGEL_CONFDIR="$BRIEGEL_PREFIX/etc/briegel"
[ "$BRIEGEL_TARGET_DIR" ]       || BRIEGEL_TARGET_DIR="$BRIEGEL_CONFDIR/targets/$BRIEGEL_TARGET"
[ "$BRIEGEL_TARGET_SCRIPTDIR" ] || BRIEGEL_TARGET_SCRIPTDIR="$BRIEGEL_TARGET_DIR/scripts"

SCRIPTS="kernel-configure
         kernel-rebuild
         create-toolchain
         create-package
         create-image
         fetch-source
         install-port
         install-special
         setup-sysroot
         check-update
         build-all
         cf-query
"

mkdir -p $BRIEGEL_TARGET_SCRIPTDIR 

(
    cd $BRIEGEL_TARGET_SCRIPTDIR
    for l in $SCRIPTS ; do 
	rm -f $l
	(
	    echo "#!/bin/sh"
	    echo "#"
	    echo "# autogenerated - do not touch manually"
	    echo "#"
	    echo "BRIEGEL_TARGET=\"$BRIEGEL_TARGET\""
	    echo "BRIEGEL_COMMAND=\"$l\""
	    echo ""
	    echo ". $BRIEGEL_LIBDIR/briegel/target-commands.sh"
	) > $l
	chmod +x $l
    done
)
